<div class="d-flex justify-content-between align-items-center mb-4">
  <h2>I miei annunci</h2>

  <button class="btn btn-primary" routerLink="/vendor/new">
    + Nuovo annuncio
  </button>
</div>

<!-- LISTA -->
<ng-container *ngIf="announcements$ | async as announcements">

  <div *ngIf="announcements.length === 0" class="alert alert-info">
    Nessun annuncio pubblicato.
  </div>

  <div class="card mb-3" *ngFor="let a of announcements">
    <div class="card-body">
      <div class="d-flex justify-content-between">
        <div>
          <h5 class="card-title">{{ a.titolo }}</h5>
          <p class="text-muted mb-1">
            € {{ a.prezzo }} · {{ a.tipo }}
          </p>
        </div>

        <div class="text-end">
          <button
            class="btn btn-sm btn-outline-secondary me-2"
            (click)="openEditModal(a)"
          >
            Modifica
          </button>

          <!-- ✅ QUI MANCAVA IL CLICK -->
          <button
            class="btn btn-sm btn-outline-danger"
            (click)="deleteAnnouncement(a.id)"
            [disabled]="deletingId === a.id"
          >
            {{ deletingId === a.id ? 'Elimino...' : 'Elimina' }}
          </button>
        </div>
      </div>
    </div>
  </div>

</ng-container>

<!-- MODALE MODIFICA ANNUNCIO -->
<div
  class="modal fade show d-block"
  tabindex="-1"
  *ngIf="showModal && selectedAnnouncement"
>
  <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Modifica annuncio</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>

      <div class="modal-body">

        <!-- TITOLO -->
        <div class="mb-3">
          <label class="form-label">Titolo</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="selectedAnnouncement.titolo"
          />
        </div>

        <!-- DESCRIZIONE -->
        <div class="mb-3">
          <label class="form-label">Descrizione</label>
          <textarea
            class="form-control"
            rows="3"
            [(ngModel)]="selectedAnnouncement.descrizione"
          ></textarea>
        </div>

        <!-- IMMAGINE -->
        <div class="mb-3">
          <label class="form-label">Image URL</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="selectedAnnouncement.imageUrl"
          />
        </div>

        <!-- PREZZO + TIPO ANNUNCIO -->
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Prezzo (€)</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="selectedAnnouncement.prezzo"
            />
          </div>

          <div class="col-md-6">
            <label class="form-label">Tipo annuncio</label>
            <select
              class="form-select"
              [(ngModel)]="selectedAnnouncement.tipo"
            >
              <option value="VENDITA">Vendita</option>
              <option value="AFFITTO">Affitto</option>
            </select>
          </div>
        </div>

        <!-- IMMOBILE -->
        <h6 class="mt-3">Dettagli immobile</h6>

        <div class="row mb-3">
          <div class="col-md-4">
            <label class="form-label">Tipo immobile</label>
            <select
              class="form-select"
              [(ngModel)]="selectedAnnouncement.immobile.tipo"
            >
              <option value="APPARTAMENTO">Appartamento</option>
              <option value="MONOLOCALE">Monolocale</option>
              <option value="VILLA">Villa</option>
              <option value="UFFICIO">Ufficio</option>
            </select>
          </div>

          <div class="col-md-4">
            <label class="form-label">Superficie (mq)</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="selectedAnnouncement.immobile.superficieMq"
            />
          </div>

          <div class="col-md-4">
            <label class="form-label">Stanze</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="selectedAnnouncement.immobile.stanze"
            />
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-4">
            <label class="form-label">Bagni</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="selectedAnnouncement.immobile.bagni"
            />
          </div>
        </div>

        <!-- LOCATION -->
        <h6 class="mt-3">Localizzazione</h6>

        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Indirizzo</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="selectedAnnouncement.immobile.location.address"
            />
          </div>

          <div class="col-md-3">
            <label class="form-label">Città</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="selectedAnnouncement.immobile.location.city"
            />
          </div>

          <div class="col-md-3">
            <label class="form-label">Latitudine</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="selectedAnnouncement.immobile.location.latitude"
            />
          </div>
        </div>

        <div class="row mb-3">
          <div class="col-md-3">
            <label class="form-label">Longitudine</label>
            <input
              type="number"
              class="form-control"
              [(ngModel)]="selectedAnnouncement.immobile.location.longitude"
            />
          </div>
        </div>

      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()" [disabled]="saving">
          Annulla
        </button>
        <button class="btn btn-primary" (click)="submitEdit()" [disabled]="saving">
          {{ saving ? 'Salvo...' : 'Invia' }}
        </button>
      </div>

    </div>
  </div>
</div>

<!-- BACKDROP -->
<div class="modal-backdrop fade show" *ngIf="showModal"></div>
